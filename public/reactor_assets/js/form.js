!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){function i(i,e){var s=t('<div class="minicolors" />'),n=t.minicolors.defaults,a=i.attr("data-format"),o=i.attr("data-keywords"),l=i.attr("data-opacity");i.data("minicolors-initialized")||(e=t.extend(!0,{},n,e),s.addClass("minicolors-theme-"+e.theme).toggleClass("minicolors-with-opacity",e.opacity).toggleClass("minicolors-no-data-uris",e.dataUris!==!0),void 0!==e.position&&t.each(e.position.split(" "),function(){s.addClass("minicolors-position-"+this)}),"rgb"===a?$input_size=l?"25":"20":$input_size=o?"11":"7",i.addClass("minicolors-input").data("minicolors-initialized",!1).data("minicolors-settings",e).prop("size",$input_size).wrap(s).after('<div class="minicolors-panel minicolors-slider-'+e.control+'"><div class="minicolors-slider minicolors-sprite"><div class="minicolors-picker"></div></div><div class="minicolors-opacity-slider minicolors-sprite"><div class="minicolors-picker"></div></div><div class="minicolors-grid minicolors-sprite"><div class="minicolors-grid-inner"></div><div class="minicolors-picker"><div></div></div></div></div>'),e.inline||(i.after('<span class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></span>'),i.next(".minicolors-swatch").on("click",function(t){t.preventDefault(),i.focus()})),i.parent().find(".minicolors-panel").on("selectstart",function(){return!1}).end(),e.inline&&i.parent().addClass("minicolors-inline"),r(i,!1),i.data("minicolors-initialized",!0))}function e(t){var i=t.parent();t.removeData("minicolors-initialized").removeData("minicolors-settings").removeProp("size").removeClass("minicolors-input"),i.before(t).remove()}function s(t){var i=t.parent(),e=i.find(".minicolors-panel"),s=t.data("minicolors-settings");!t.data("minicolors-initialized")||t.prop("disabled")||i.hasClass("minicolors-inline")||i.hasClass("minicolors-focus")||(n(),i.addClass("minicolors-focus"),e.stop(!0,!0).fadeIn(s.showSpeed,function(){s.show&&s.show.call(t.get(0))}))}function n(){t(".minicolors-focus").each(function(){var i=t(this),e=i.find(".minicolors-input"),s=i.find(".minicolors-panel"),n=e.data("minicolors-settings");s.fadeOut(n.hideSpeed,function(){n.hide&&n.hide.call(e.get(0)),i.removeClass("minicolors-focus")})})}function a(t,i,e){var s,n,a,r,l=t.parents(".minicolors").find(".minicolors-input"),c=l.data("minicolors-settings"),h=t.find("[class$=-picker]"),d=t.offset().left,u=t.offset().top,p=Math.round(i.pageX-d),f=Math.round(i.pageY-u),m=e?c.animationSpeed:0;i.originalEvent.changedTouches&&(p=i.originalEvent.changedTouches[0].pageX-d,f=i.originalEvent.changedTouches[0].pageY-u),0>p&&(p=0),0>f&&(f=0),p>t.width()&&(p=t.width()),f>t.height()&&(f=t.height()),t.parent().is(".minicolors-slider-wheel")&&h.parent().is(".minicolors-grid")&&(s=75-p,n=75-f,a=Math.sqrt(s*s+n*n),r=Math.atan2(n,s),0>r&&(r+=2*Math.PI),a>75&&(a=75,p=75-75*Math.cos(r),f=75-75*Math.sin(r)),p=Math.round(p),f=Math.round(f)),t.is(".minicolors-grid")?h.stop(!0).animate({top:f+"px",left:p+"px"},m,c.animationEasing,function(){o(l,t)}):h.stop(!0).animate({top:f+"px"},m,c.animationEasing,function(){o(l,t)})}function o(t,i){function e(t,i){var e,s;return t.length&&i?(e=t.offset().left,s=t.offset().top,{x:e-i.offset().left+t.outerWidth()/2,y:s-i.offset().top+t.outerHeight()/2}):null}var s,n,a,o,r,c,h,u=t.val(),p=t.attr("data-format"),f=(t.attr("data-keywords"),t.attr("data-opacity")),g=t.parent(),v=t.data("minicolors-settings"),b=g.find(".minicolors-swatch"),y=g.find(".minicolors-grid"),_=g.find(".minicolors-slider"),C=g.find(".minicolors-opacity-slider"),$=y.find("[class$=-picker]"),x=_.find("[class$=-picker]"),S=C.find("[class$=-picker]"),D=e($,y),L=e(x,_),M=e(S,C);if(i.is(".minicolors-grid, .minicolors-slider, .minicolors-opacity-slider")){switch(v.control){case"wheel":o=y.width()/2-D.x,r=y.height()/2-D.y,c=Math.sqrt(o*o+r*r),h=Math.atan2(r,o),0>h&&(h+=2*Math.PI),c>75&&(c=75,D.x=69-75*Math.cos(h),D.y=69-75*Math.sin(h)),n=m(c/.75,0,100),s=m(180*h/Math.PI,0,360),a=m(100-Math.floor(L.y*(100/_.height())),0,100),u=w({h:s,s:n,b:a}),_.css("backgroundColor",w({h:s,s:n,b:100}));break;case"saturation":s=m(parseInt(D.x*(360/y.width()),10),0,360),n=m(100-Math.floor(L.y*(100/_.height())),0,100),a=m(100-Math.floor(D.y*(100/y.height())),0,100),u=w({h:s,s:n,b:a}),_.css("backgroundColor",w({h:s,s:100,b:a})),g.find(".minicolors-grid-inner").css("opacity",n/100);break;case"brightness":s=m(parseInt(D.x*(360/y.width()),10),0,360),n=m(100-Math.floor(D.y*(100/y.height())),0,100),a=m(100-Math.floor(L.y*(100/_.height())),0,100),u=w({h:s,s:n,b:a}),_.css("backgroundColor",w({h:s,s:n,b:100})),g.find(".minicolors-grid-inner").css("opacity",1-a/100);break;default:s=m(360-parseInt(L.y*(360/_.height()),10),0,360),n=m(Math.floor(D.x*(100/y.width())),0,100),a=m(100-Math.floor(D.y*(100/y.height())),0,100),u=w({h:s,s:n,b:a}),y.css("backgroundColor",w({h:s,s:100,b:100}))}if(f=v.opacity?parseFloat(1-M.y/C.height()).toFixed(2):1,v.opacity&&t.attr("data-opacity",f),"rgb"===p){var z=k(u),f=""===t.attr("data-opacity")?1:m(parseFloat(t.attr("data-opacity")).toFixed(2),0,1);(isNaN(f)||!v.opacity)&&(f=1),t.minicolors("rgbObject").a<=1&&z&&v.opacity?value="rgba("+z.r+", "+z.g+", "+z.b+", "+parseFloat(f)+")":value="rgb("+z.r+", "+z.g+", "+z.b+")"}else value=d(u,v.letterCase);t.val(value)}b.find("span").css({backgroundColor:u,opacity:f}),l(t,value,f)}function r(i,e){var s,n,a,o,r,c,h,b=(i.attr("data-format"),i.attr("data-keywords")),_=i.parent(),$=i.data("minicolors-settings"),k=_.find(".minicolors-swatch"),x=_.find(".minicolors-grid"),S=_.find(".minicolors-slider"),D=_.find(".minicolors-opacity-slider"),L=x.find("[class$=-picker]"),M=S.find("[class$=-picker]"),z=D.find("[class$=-picker]");switch(g(i.val())?(s=y(i.val()),alpha=m(parseFloat(v(i.val())).toFixed(2),0,1),alpha&&i.attr("data-opacity",alpha)):s=d(u(i.val(),!0),$.letterCase),s||(s=d(f($.defaultValue,!0),$.letterCase)),n=C(s),b=b?t.map(b.split(","),function(i){return t.trim(i.toLowerCase())}):[],""!==i.val()&&t.inArray(i.val().toLowerCase(),b)>-1?value=d(i.val()):value=g(i.val())?p(i.val()):s,e||i.val(value),$.opacity&&(a=""===i.attr("data-opacity")?1:m(parseFloat(i.attr("data-opacity")).toFixed(2),0,1),isNaN(a)&&(a=1),i.attr("data-opacity",a),k.find("span").css("opacity",a),r=m(D.height()-D.height()*a,0,D.height()),z.css("top",r+"px")),"transparent"===i.val().toLowerCase()&&k.find("span").css("opacity",0),k.find("span").css("backgroundColor",s),$.control){case"wheel":c=m(Math.ceil(.75*n.s),0,x.height()/2),h=n.h*Math.PI/180,o=m(75-Math.cos(h)*c,0,x.width()),r=m(75-Math.sin(h)*c,0,x.height()),L.css({top:r+"px",left:o+"px"}),r=150-n.b/(100/x.height()),""===s&&(r=0),M.css("top",r+"px"),S.css("backgroundColor",w({h:n.h,s:n.s,b:100}));break;case"saturation":o=m(5*n.h/12,0,150),r=m(x.height()-Math.ceil(n.b/(100/x.height())),0,x.height()),L.css({top:r+"px",left:o+"px"}),r=m(S.height()-n.s*(S.height()/100),0,S.height()),M.css("top",r+"px"),S.css("backgroundColor",w({h:n.h,s:100,b:n.b})),_.find(".minicolors-grid-inner").css("opacity",n.s/100);break;case"brightness":o=m(5*n.h/12,0,150),r=m(x.height()-Math.ceil(n.s/(100/x.height())),0,x.height()),L.css({top:r+"px",left:o+"px"}),r=m(S.height()-n.b*(S.height()/100),0,S.height()),M.css("top",r+"px"),S.css("backgroundColor",w({h:n.h,s:n.s,b:100})),_.find(".minicolors-grid-inner").css("opacity",1-n.b/100);break;default:o=m(Math.ceil(n.s/(100/x.width())),0,x.width()),r=m(x.height()-Math.ceil(n.b/(100/x.height())),0,x.height()),L.css({top:r+"px",left:o+"px"}),r=m(S.height()-n.h/(360/S.height()),0,S.height()),M.css("top",r+"px"),x.css("backgroundColor",w({h:n.h,s:100,b:100}))}i.data("minicolors-initialized")&&l(i,value,a)}function l(t,i,e){var s=t.data("minicolors-settings"),n=t.data("minicolors-lastChange");n&&n.value===i&&n.opacity===e||(t.data("minicolors-lastChange",{value:i,opacity:e}),s.change&&(s.changeDelay?(clearTimeout(t.data("minicolors-changeTimeout")),t.data("minicolors-changeTimeout",setTimeout(function(){s.change.call(t.get(0),i,e)},s.changeDelay))):s.change.call(t.get(0),i,e)),t.trigger("change").trigger("input"))}function c(i){var e=u(t(i).val(),!0),s=k(e),n=t(i).attr("data-opacity");return s?(void 0!==n&&t.extend(s,{a:parseFloat(n)}),s):null}function h(i,e){var s=u(t(i).val(),!0),n=k(s),a=t(i).attr("data-opacity");return n?(void 0===a&&(a=1),e?"rgba("+n.r+", "+n.g+", "+n.b+", "+parseFloat(a)+")":"rgb("+n.r+", "+n.g+", "+n.b+")"):null}function d(t,i){return"uppercase"===i?t.toUpperCase():t.toLowerCase()}function u(t,i){return t=t.replace(/^#/g,""),t.match(/^[A-F0-9]{3,6}/gi)?3!==t.length&&6!==t.length?"":(3===t.length&&i&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),"#"+t):""}function p(t,i){var e=t.replace(/[^\d,.]/g,""),s=e.split(",");return s[0]=m(parseInt(s[0],10),0,255),s[1]=m(parseInt(s[1],10),0,255),s[2]=m(parseInt(s[2],10),0,255),s[3]&&(s[3]=m(parseFloat(s[3],10),0,1)),i?{r:s[0],g:s[1],b:s[2],a:s[3]?s[3]:null}:"undefined"!=typeof s[3]&&s[3]<=1?"rgba("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+")":"rgb("+s[0]+", "+s[1]+", "+s[2]+")"}function f(t,i){return g(t)?p(t):u(t,i)}function m(t,i,e){return i>t&&(t=i),t>e&&(t=e),t}function g(t){return rgb=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),rgb&&4===rgb.length?!0:!1}function v(t){return t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i),t&&6===t.length?t[4]:"1"}function b(t){var i={},e=Math.round(t.h),s=Math.round(255*t.s/100),n=Math.round(255*t.b/100);if(0===s)i.r=i.g=i.b=n;else{var a=n,o=(255-s)*n/255,r=(a-o)*(e%60)/60;360===e&&(e=0),60>e?(i.r=a,i.b=o,i.g=o+r):120>e?(i.g=a,i.b=o,i.r=a-r):180>e?(i.g=a,i.r=o,i.b=o+r):240>e?(i.b=a,i.r=o,i.g=a-r):300>e?(i.b=a,i.g=o,i.r=o+r):360>e?(i.r=a,i.g=o,i.b=a-r):(i.r=0,i.g=0,i.b=0)}return{r:Math.round(i.r),g:Math.round(i.g),b:Math.round(i.b)}}function y(t){return t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),t&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):""}function _(i){var e=[i.r.toString(16),i.g.toString(16),i.b.toString(16)];return t.each(e,function(t,i){1===i.length&&(e[t]="0"+i)}),"#"+e.join("")}function w(t){return _(b(t))}function C(t){var i=$(k(t));return 0===i.s&&(i.h=360),i}function $(t){var i={h:0,s:0,b:0},e=Math.min(t.r,t.g,t.b),s=Math.max(t.r,t.g,t.b),n=s-e;return i.b=s,i.s=0!==s?255*n/s:0,0!==i.s?t.r===s?i.h=(t.g-t.b)/n:t.g===s?i.h=2+(t.b-t.r)/n:i.h=4+(t.r-t.g)/n:i.h=-1,i.h*=60,i.h<0&&(i.h+=360),i.s*=100/255,i.b*=100/255,i}function k(t){return t=parseInt(t.indexOf("#")>-1?t.substring(1):t,16),{r:t>>16,g:(65280&t)>>8,b:255&t}}t.minicolors={defaults:{animationSpeed:50,animationEasing:"swing",change:null,changeDelay:0,control:"hue",dataUris:!0,defaultValue:"",format:"hex",hide:null,hideSpeed:100,inline:!1,keywords:"",letterCase:"lowercase",opacity:!1,position:"bottom left",show:null,showSpeed:100,theme:"default"}},t.extend(t.fn,{minicolors:function(a,o){switch(a){case"destroy":return t(this).each(function(){e(t(this))}),t(this);case"hide":return n(),t(this);case"opacity":return void 0===o?t(this).attr("data-opacity"):(t(this).each(function(){r(t(this).attr("data-opacity",o))}),t(this));case"rgbObject":return c(t(this),"rgbaObject"===a);case"rgbString":case"rgbaString":return h(t(this),"rgbaString"===a);case"settings":return void 0===o?t(this).data("minicolors-settings"):(t(this).each(function(){var i=t(this).data("minicolors-settings")||{};e(t(this)),t(this).minicolors(t.extend(!0,i,o))}),t(this));case"show":return s(t(this).eq(0)),t(this);case"value":return void 0===o?t(this).val():(t(this).each(function(){"object"==typeof o?(o.opacity&&t(this).attr("data-opacity",m(o.opacity,0,1)),o.color&&t(this).val(o.color)):t(this).val(o),r(t(this))}),t(this));default:return"create"!==a&&(o=a),t(this).each(function(){i(t(this),o)}),t(this)}}}),t(document).on("mousedown.minicolors touchstart.minicolors",function(i){t(i.target).parents().add(i.target).hasClass("minicolors")||n()}).on("mousedown.minicolors touchstart.minicolors",".minicolors-grid, .minicolors-slider, .minicolors-opacity-slider",function(i){var e=t(this);i.preventDefault(),t(document).data("minicolors-target",e),a(e,i,!0)}).on("mousemove.minicolors touchmove.minicolors",function(i){var e=t(document).data("minicolors-target");e&&a(e,i)}).on("mouseup.minicolors touchend.minicolors",function(){t(this).removeData("minicolors-target")}).on("mousedown.minicolors touchstart.minicolors",".minicolors-swatch",function(i){var e=t(this).parent().find(".minicolors-input");i.preventDefault(),s(e)}).on("focus.minicolors",".minicolors-input",function(){var i=t(this);i.data("minicolors-initialized")&&s(i)}).on("blur.minicolors",".minicolors-input",function(){var i,e,s,n=t(this),a=n.attr("data-keywords"),o=n.data("minicolors-settings");n.data("minicolors-initialized")&&(a=a?t.map(a.split(","),function(i){return t.trim(i.toLowerCase())}):[],""!==n.val()&&t.inArray(n.val().toLowerCase(),a)>-1?value=n.val():(g(n.val())?e=p(n.val(),!0):(i=u(n.val(),!0),e=i?k(i):null),null===e?value=o.defaultValue:"rgb"===o.format?value=p(o.opacity?"rgba("+e.r+","+e.g+","+e.b+","+n.attr("data-opacity")+")":"rgb("+e.r+","+e.g+","+e.b+")"):value=_(e)),s=o.opacity?n.attr("data-opacity"):1,"transparent"===value.toLowerCase()&&(s=0),n.closest(".minicolors").find(".minicolors-swatch > span").css("opacity",s),n.val(value),""===n.val()&&n.val(f(o.defaultValue,!0)),n.val(d(n.val(),o.letterCase)))}).on("keydown.minicolors",".minicolors-input",function(i){var e=t(this);if(e.data("minicolors-initialized"))switch(i.keyCode){case 9:n();break;case 13:case 27:n(),e.blur()}}).on("keyup.minicolors",".minicolors-input",function(){var i=t(this);i.data("minicolors-initialized")&&r(i,!0)}).on("paste.minicolors",".minicolors-input",function(){var i=t(this);i.data("minicolors-initialized")&&setTimeout(function(){r(i,!0)},1)})}),function(t){t.fn.unveil=function(i,e){function s(){var i=c.filter(function(){var i=t(this);if(!i.is(":hidden")){var e=a.scrollTop(),s=e+a.height(),n=i.offset().top,r=n+i.height();return r>=e-o&&s+o>=n}});n=i.trigger("unveil"),c=c.not(n)}var n,a=t(window),o=i||0,r=window.devicePixelRatio>1,l=r?"data-src-retina":"data-src",c=this;return this.one("unveil",function(){var t=this.getAttribute(l);t=t||this.getAttribute("data-src"),t&&(this.setAttribute("src",t),"function"==typeof e&&e.call(this))}),a.on("scroll.unveil resize.unveil lookup.unveil",s),s(),this}}(window.jQuery||window.Zepto),function(t){"use strict";function i(t,i,e){this.el=t,i=i||'input[type="password"]',e=e||".strength-meter > div",this.field=this.el.find(i),this.meter=this.el.find(e),this._init()}i.prototype={_init:function(){this.characters=0,this.capitalletters=0,this.lowerletters=0,this.number=0,this.special=0,this.upperCase=new RegExp("[A-Z]"),this.lowerCase=new RegExp("[a-z]"),this.numbers=new RegExp("[0-9]"),this.specialchars=new RegExp("([!,%,&,@,#,$,^,*,?,_,~,/])");var t=this;this.field.on("keyup keydown",function(){t._checkStrength($(this).val())})},_setPercentage:function(t){this.meter.css({width:t+"%"})},_setClass:function(t){1>=t?(this.meter.removeClass(),this.meter.addClass("veryweak")):2===t?(this.meter.removeClass(),this.meter.addClass("weak")):3===t?(this.meter.removeClass(),this.meter.addClass("medium")):(this.meter.removeClass(),this.meter.addClass("strong"))},_checkStrength:function(t){t.length>=8?this.characters=1:this.characters=0,t.match(this.upperCase)?this.capitalletters=1:this.capitalletters=0,t.match(this.lowerCase)?this.lowerletters=1:this.lowerletters=0,t.match(this.numbers)?this.number=1:this.number=0,t.match(this.specialchars)?this.special=1:this.special=0;var i=this._getTotal(),e=this._getPercentage(5,i);this._setPercentage(e),this._setClass(i)},_getPercentage:function(t,i){return i/t*100},_getTotal:function(){return this.characters+this.capitalletters+this.lowerletters+this.number+this.special}},t.Meter=i}(window),function(t){"use strict";function i(t){this.el=t,this._init()}i.prototype={_init:function(){this.input=this.el.find('input[type="text"]');var t="undefined"!=typeof this.input.data("follows")?this.input.data("follows"):"#title";this.follow=$(t),this.dirty=""!==this.input.val()?!0:!1,this._initEvents()},_initEvents:function(){var t=this;this.input.on("keyup",function(){t.dirty=!0}),this.follow.on("keyup",function(){t.dirty||t._setSlug()}),this.input.on("blur",function(){""===t.input.val()&&(t.changed=!1,t._setSlug())})},_setSlug:function(){var t=this._slugify(this.follow.val());this.input.val(t)},_slugify:function(t){t=t.replace(/^\s+|\s+$/g,"").toLowerCase();for(var i="àáäâèéëêıìíïîòóöôùúüûñçğş·/_,:;",e="aaaaeeeeiiiiioooouuuuncgs------",s=0,n=i.length;n>s;s++)t=t.replace(new RegExp(i.charAt(s),"g"),e.charAt(s));return t.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}},t.Slug=i}(window),function(t){"use strict";function i(t){this.el=t,this._init()}i.prototype={_init:function(){this.list=this.el.find("ul.taglist"),this.inputItem=this.el.find("div.tag-input"),this.input=this.inputItem.find('input[name="_tag"]'),this.valueInput=this.el.find('input[type="hidden"]'),this.tags=[],this._extractValue(),this._initEvents()},_initEvents:function(){var t=this;this.input.bind("keydown",function(i){var e=$(this);if(27===i.which)i.stopPropagation(),""===e.val()?e.blur():e.val("");else if(9===i.which||13===i.which){i.preventDefault();var s=e.val().trim();""!==s&&t._addTag(e.val())&&e.val("")}}),this.list.on("click",".icon-cancel",function(){t._removeTag($(this))})},_extractValue:function(){var t=this.valueInput.val().trim();if(""!==t){t=t.split(",");for(var i=0;i<t.length;i++)this._addTag(t[i])}this._setListClass(this.tags)},_removeTag:function(t){var i=t.parents(".tag");delete this.tags[i.data("id")],i.remove(),this._setValue()},_addTag:function(t){var i=this.tags.indexOf(t);if(i>-1){var e=this.list.find('li[data-id="'+i+'"]');return e.addClass("flash"),setTimeout(function(){e.removeClass("flash")},100),!1}return this.tags.push(t),i=this.tags.indexOf(t),this._createTag(i,t),this._setValue(),!0},_createTag:function(t,i){$('<li class="tag" data-id="'+t+'">'+html_entities(i)+'<i class="icon-cancel"></i></li>').appendTo(this.list)},_setValue:function(){var t=$.grep(this.tags,function(t){return t});this.valueInput.val(t.join(",")),this._setListClass(t)},_setListClass:function(t){0===t.length?this.list.addClass("empty"):this.list.removeClass("empty")}},t.TagLegacy=i}(window),function(t){"use strict";function i(t,i){this._init(t,i)}function e(t,i){this._init(t,i)}i.prototype={_init:function(t,i){this.zone=t;var e={selectButton:"#dropzone-select-button",uploadInput:"#dropzone-file",outputList:"#upload-list",indicator:null,enabled:!0,append:!0};this.options=$.extend(e,i),this.action=$(this.zone).attr("action"),this.fileQueue=[],this.statusIndicators=[],this.current=0,this.inProcess=!1,this.maxsize=this.zone.data("maxsize"),this._initEvents()},_initEvents:function(){var i=this;this.zone.bind("dragenter, dragover",function(t){t.preventDefault(),t.stopPropagation(),$(this).addClass("dragenter")}),this.zone.bind("dragleave",function(){$(this).removeClass("dragenter")}),$(t).bind("drop",function(t){t.preventDefault(),t.stopPropagation()}),this.zone.bind("drop",function(t){t.preventDefault(),t.stopPropagation(),i.queue(t.originalEvent.dataTransfer.files),$(this).removeClass("dragenter")}),$(this.options.uploadInput).bind("change",function(){i.queue($(this)[0].files)}),this.options.selectButton!==!1&&$(this.options.selectButton).bind("click",function(t){t.preventDefault(),t.stopPropagation(),$(i.options.uploadInput).click()})},queue:function(t){if(!this.options.enabled)return!1;for(var i=0;i<t.length;i++)if(t[i].size<this.maxsize){var e=new FormData;e.append("file",t[i]),this.fileQueue.push(e);var s=this._createIndicator(html_entities(t[i].name),t[i].size);this.statusIndicators.push(s),this.options.outputList!==!1&&(this.options.append===!0?$(this.options.outputList).append(s.parent):$(this.options.outputList).prepend(s.parent))}this.inProcess===!1&&this._upload()},_createIndicator:function(i,e){var s=this.options.indicator?this.options.indicator:"Indicator";return new(s=t[s])(i,e)},_upload:function(){var t=this;if(this.current<this.fileQueue.length){this.inProcess=!0;var i=this.fileQueue[this.current],e=this.statusIndicators[this.current];$.ajax({xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){e.setProgress(loaded(t))}),t},url:t.action,type:"POST",contentType:!1,processData:!1,cache:!1,data:i,success:function(t){e.complete(t)}}).always(function(){t.current++,t._upload()})}else this.inProcess=!1}},t.Uploader=i,e.prototype={_init:function(t,i){this.parent=$('<li class="material-light"></li>'),this.progressContainer=$('<div class="upload-progress-container"></div>').appendTo(this.parent),this.progressBar=$('<div class="upload-progress-bar"></div>').appendTo(this.progressContainer),this.messageWrapper=$('<div class="upload-message-wrapper"></div>').appendTo(this.parent),this.thumbnail=$('<span class="upload-thumbnail"></span>').appendTo(this.messageWrapper),this.container=$("<p></p>").appendTo(this.messageWrapper),this.filename=$('<span class="upload-text">'+t+"</span>").appendTo(this.container),this.message=$('<span class="upload-text muted">'+readable_size(i)+"</span>").appendTo(this.container),this.container.clone().appendTo(this.progressContainer)},setProgress:function(t){this.progressBar.width(t.toString()+"%")},complete:function(t){this.setProgress(100),"success"===t.type?this._success(t.response):"error"===t.type&&this._error(t)},_success:function(t){$(this.parent).addClass("complete"),this.thumbnail.html(t.thumbnail),this.message.html(t.mimetype+" | "+this.message.text())},_error:function(t){$(this.parent).addClass("error"),$(this.thumbnail).html('<i class="icon-cancel"></i>'),$(this.message).html(t.response)}},t.Indicator=e}(window),function(t){"use strict";function i(t){this.container=t,this._init()}function e(i,e){this._init(i),this.app=t.documentsLibrary}i.prototype={_init:function(){this.retrieveURL=this.container.data("retrieveurl"),this.loadURL=this.container.data("loadurl"),this.placeholderURL=this.container.data("placeholderurl"),this.modal=this.container.find("#library-modal"),this.scroller=this.modal.find("#library-modal-columns"),this.mediaList=$("#library-modal-media-list"),this.searchForm=this.modal.find("#library-modal-search"),this.noResults=this.modal.find("#library-modal-noresults"),this.disabler=this.modal.find("#library-modal-disabler"),this.mediaDetails=this.modal.find("#library-modal-media-detail"),this.gallerySortable=this.modal.find("#library-modal-gallery-sortable"),this.numSelected=this.modal.find("#library-modal-gallery-selected > span"),this.clearButton=this.modal.find("#library-modal-clear"),this.removeButton=this.modal.find("#library-modal-remove"),this.insertButton=this.modal.find("#library-modal-insert"),this.closeButton=this.modal.find("#library-modal-close"),this.mediaScroller=this.modal.find(".column-media-list .scroller-library"),this.dropzone=this.container.find("#library-modal-dropzone"),this.controller=null,this.isOpen=!1,this.isBooted=!1,this.mode=null,this.masterFilter=null,this.lastValue=null,this.controllerDirty=!1,this.loaded=[],this.offset=0,this.take=30,this.isLoading=!1,this.canLoadMode=!0,this.dialog=new Modal($("#library-modal-container")),this.uploader=new Uploader($("#library-modal-dropzone"),{outputList:this.mediaList,enabled:!1,append:!1,indicator:"LibraryIndicator"}),this._disableList(),this._initEvents()},_initEvents:function(){var i=this;this.scroller.find(".library-modal-scroll-button").on("click",function(){$(this).hasClass("right")?i.scroller.addClass("scrolled"):$(this).hasClass("left")&&i.scroller.removeClass("scrolled")}),this.modal.on("click",function(t){t.stopPropagation()}),this.clearButton.on("click",function(t){i._clearGallery(),t.preventDefault(),t.stopPropagation()}),this.removeButton.on("click",function(){i._deselectDocument(),i.controller.setValue(null),i.close()}),this.searchForm.on("submit",function(t){if(t.preventDefault(),t.stopPropagation(),!$(this).hasClass("disabled")){var e=$(this).find('input[name="q"]'),s=e.val();i._search(s)}}),this.searchForm.find('input[type="search"]').bind("keydown",function(t){27===t.keyCode&&(t.stopPropagation(),""===$(this).val()?$(this).blur():i._search(""))}),this.gallerySortable.sortable({cursor:"move",tolerance:"pointer",placeholder:"placeholder",opacity:.7,delay:50,scroll:!1}).disableSelection(),this.gallerySortable.on("click",".library-modal-sortable-remove",function(t){var e=$(this).parent();i._deselectGallery($("#md_"+e.data("id"))),e.remove(),t.preventDefault(),t.stopPropagation()}),this.container.on("dragenter dragover",function(t){t.preventDefault(),t.stopPropagation(),i.dropzone.addClass("dragenter")}),this.dropzone.on("dragleave",function(){$(this).removeClass("dragenter")}),this.dropzone.on("drop",function(t){t.preventDefault(),$(this).removeClass("dragenter")}),this.closeButton.on("click",function(){i.close()}),this.mediaScroller.on("scroll.unveil resize.unveil lookup.unveil",function(){$(t).trigger("scroll.unveil"),i.mediaList.height()-i.mediaScroller.height()-i.mediaScroller.scrollTop()-200<=0&&i._load()})},run:function(t){this.controller!==t?(this.controller=t,this._reset(),this.controllerDirty=!0,this._setMode(t.type),this._retrieve(t)):this._initByMode(),this.open()},_boot:function(){this.isBooted||(this.isBooted=!0,this._enableList(),this._enableUploader(),this._load())},_retrieve:function(t){var i=this,e=t.getValue();return""===e.trim()?(this._initByMode(),void this._boot()):("gallery"!==t.type&&(e=JSON.stringify([e])),void $.getJSON(this.retrieveURL,{ids:e},function(t){i._populateList(t),i._boot(),i._initByMode()}))},_initByMode:function(){"gallery"===this.mode?this._initGallery():this._initDocument()},_initGallery:function(){if(this.controllerDirty===!0){var t=this;this._setMasterFilter("image"),this.mediaList.unbind("click").on("click","li",function(){t._selectForGallery($(this))}),this.insertButton.unbind("click").on("click",function(){t.controller.setValue(t._parseForGallery()),t.close()}),this.controllerDirty=!1}var i=this.controller.getValue();if(this.isBooted&&this.lastValue!==i){if(this.lastValue=i,this._clearGallery(),""!==i&&i.length>0){i=JSON.parse(i);for(var e=i.length-1;e>=0;e--){var s=$("#md_"+i[e]);s.length>0&&this._selectGallery(s)}}this._recalculateSelected()}},_initDocument:function(){if(this.controllerDirty===!0){var t=this;"undefined"!=typeof this.controller.filter&&this._setMasterFilter(this.controller.filter),this.mediaList.unbind("click").on("click","li",function(){t._selectForDocument($(this))}),this.insertButton.unbind("click").on("click",function(){t.controller.setValue(t._parseForDocument()),t.close()}),this.controllerDirty=!1}var i=this.controller.getValue();if(this.isBooted&&this.lastValue!==i){this.lastValue=i;var e=$("#md_"+i);e.length>0?this._selectDocument(e):this._deselectDocument()}},selectMediaById:function(t){var i=$("#md_"+t);i.length>0&&("gallery"===this.mode?this._selectForGallery(i):this._selectForDocument(i))},_selectForDocument:function(t){return t.hasClass("indicator")?!1:void(t.hasClass("selected")?this._deselectDocument():this._selectDocument(t))},_selectDocument:function(t){this.mediaList.children("li.selected").removeClass("selected"),t.addClass("selected"),this.mediaDetails.addClass("selected"),this.mediaDetails.data("id",t.data("id"));var i=this.mediaDetails.children(".library-modal-media-tag"),e=i.find(".media-name"),s=i.find(".media-detail"),n=i.find(".media-thumbnail");if(e.text(t.data("name")),isNaN(t.data("size"))||"0"==t.data("size"))var a=t.data("mimetype");else var a=t.data("mimetype")+" | "+readable_size(t.data("size"));s.text(a),n.html(t.find(".document-thumbnail").clone())},_deselectDocument:function(){this.mediaList.children("li.selected").removeClass("selected"),this.mediaDetails.removeClass("selected"),this.mediaDetails.data("id","")},_selectForGallery:function(t){return t.hasClass("indicator")||t.hasClass("filtered")?!1:(t.hasClass("selected")?this._deselectGallery(t):this._selectGallery(t),void this._recalculateSelected())},_selectGallery:function(t){t.addClass("selected");var i=$('<li data-id="'+t.data("id")+'" id="gl_'+t.data("id")+'"></li>');$('<img src="'+t.find("img").attr("src")+'">').appendTo(i),$('<i class="icon-cancel library-modal-sortable-remove"></i>').appendTo(i),this.gallerySortable.prepend(i)},_deselectGallery:function(t){t.removeClass("selected"),this.gallerySortable.find("#gl_"+t.data("id")).remove(),this._recalculateSelected()},_clearGallery:function(){this.mediaList.children("li.selected").removeClass("selected"),this.gallerySortable.empty(),this.numSelected.text(0)},_recalculateSelected:function(){var t=this.gallerySortable.children("li").length;this.numSelected.text(t)},_parseMedia:function(t){var i=$("#md_"+t);return i.length>0?{id:t,name:i.data("name"),thumbnail:i.find(".document-thumbnail").children("img,i").clone()}:null},_parseForDocument:function(){var t=this.mediaDetails.data("id");return this._parseMedia(t)},_parseForGallery:function(){for(var t=[],i=this.gallerySortable.children("li"),e=0;e<i.length;e++){var s=i.eq(e).data("id");t.push(this._parseMedia(s))}return t},open:function(){this.dialog.openModal()},close:function(){this.dialog.closeModal()},_setMode:function(t){this.mode=t,this.container.removeClass("library-modal-mode-gallery library-modal-mode-document"),this.container.addClass("library-modal-mode-"+t)},_setMasterFilter:function(t){this.masterFilter=t,this._filter(t)},refilter:function(){this._filter(this.masterFilter)},_reset:function(){this.masterFilter=null,this._deselectDocument(),this._clearGallery(),this.mediaList.children("li").removeClass()},_load:function(){var t=this;!t.isLoading&&this.canLoadMode&&(t.isLoading=!0,$.getJSON(this.loadURL,{offset:t.offset},function(i){i.remaining<=0&&(t.canLoadMode=!1),t._populateList(i.media),t.isLoading=!1,t.offset+=t.take}))},_populateList:function(t){for(var i=0;i<t.length;i++){var e=t[i];-1==this.loaded.indexOf(parseInt(e.id))&&(this.loaded.push(parseInt(e.id)),this.mediaList.append(this.createMediaThumbnail(e)))}this._sortItems(),this.refilter(),this._unveil()},createMediaThumbnail:function(t){var i=$('<li data-id="'+t.id+'" id="md_'+t.id+'" data-name="'+html_entities(t.name)+'" data-flag="'+t.type+'" data-size="'+t.size+'" data-mimetype="'+t.mimetype+'">');return"image"==t.type&&(t.thumbnail='<img class="unveil" src="'+this.placeholderURL+'" data-src="'+$(t.thumbnail).attr("src")+'">'),$('<div class="document-thumbnail">'+t.thumbnail+"</div>").appendTo(i),$("<p>"+html_entities(t.name)+"</p>").appendTo(i),$('<i class="icon-check"></i>').appendTo(i),i},_sortItems:function(){this.mediaList.find("li").sort(function(t,i){return+i.getAttribute("data-id")-+t.getAttribute("data-id")}).appendTo(this.mediaList)},_enableList:function(){this.disabler.removeClass("active"),this.searchForm.removeClass("disabled")},_disableList:function(){this.disabler.addClass("active"),this.searchForm.addClass("disabled")},_filter:function(t){t&&"all"!==t?(this.mediaList.children("li").addClass("filtered"),this.mediaList.children('li[data-flag="'+t+'"]').removeClass("filtered")):this.mediaList.children("li").removeClass("filtered"),this._anyResults()},_search:function(t){if(""===t.trim())this.mediaList.children("li").removeClass("searched"),this._anyResults();else{var i=this;this._yesResults();var e=new FormData;e.append("q",t),this.mediaList.children("li").addClass("searched"),this._disableList(),$.ajax({url:i.searchForm.attr("action"),type:"POST",contentType:!1,processData:!1,cache:!1,data:e,success:function(t){if(t.items.length>0){i._populateList(t.items);var e="#md_"+t.ids.join(",#md_");$(e).removeClass("searched");
}i._enableList(),i._anyResults()}})}},_anyResults:function(){this.isBooted&&(this.mediaList.find("li").length===this.mediaList.find(".searched,.filtered").length?this.noResults.addClass("active"):this.noResults.removeClass("active"))},_yesResults:function(){this.noResults.removeClass("active")},_enableUploader:function(){this.uploader.options.enabled=!0},_unveil:function(){$(t).off("unveil"),this._getUnveilable().unveil(200,function(){$(this).addClass("unveiled")})},_getUnveilable:function(){return this.mediaList.find(".unveil")}},t.Library=i,e.prototype=Indicator.prototype,e.prototype._init=function(t){this.parent=$('<li class="indicator"></li>'),this.thumbnail=$('<div class="document-thumbnail"></div>'),this.thumbnail.appendTo(this.parent),this.name=$("<p>"+t+"</p>"),this.name.appendTo(this.parent),$('<i class="icon-check"></i>').appendTo(this.parent),this.progressBar=$('<div class="progress"></div>'),this.progressBar.appendTo(this.thumbnail)},e.prototype._error=function(t){this.parent.remove()},e.prototype._success=function(t){this.parent.removeClass("indicator"),this.parent.attr("data-id",t.id),this.parent.attr("id","md_"+t.id),this.parent.attr("data-name",html_entities(t.name)),this.parent.attr("data-flag",t.type),this.parent.attr("data-size",t.size),this.parent.attr("data-mimetype",t.mimetype),this.thumbnail.html(t.thumbnail),this.app.refilter(),this.app.selectMediaById(t.id)},e.prototype.setProgress=function(t){t=t.toString()+"%",this.progressBar.height(t).width(t)},t.LibraryIndicator=e}(window),function(t){"use strict";function i(t,i){this.type="gallery",this.el=t,this.library=i,this.container=this.el.find(".form-media-container"),this.input=this.el.find('input[type="hidden"]'),this.addButton=this.el.find(".button-add"),this.clearButton=this.el.find(".button-clear"),this.mediaGallery=this.el.find(".form-media-gallery"),this._initEvents()}i.prototype={_initEvents:function(){var t=this;$(this.mediaGallery).sortable({cursor:"move",tolerance:"pointer",placeholder:"placeholder",opacity:.7,delay:50,stop:function(){t._setGallery()}}).disableSelection(),Modernizr.touch||this.mediaGallery.find(".icon-cancel").on("click",function(){var i=$(this).parent();$(i).remove(),t._setGallery()}),this.clearButton.on("click",function(i){t._clearGallery(),i.preventDefault(),i.stopPropagation()}),this.addButton.on("click",function(i){t.library.run(t),i.preventDefault(),i.stopPropagation()})},_clearGallery:function(){this.input.val(""),this.mediaGallery.html(""),this.container.addClass("empty")},_parseGallery:function(){var t=$(this.mediaGallery).sortable("toArray",{attribute:"data-id"});return JSON.stringify(t)},_setGallery:function(){this.input.val(this._parseGallery())},getValue:function(){return this.input.val()},setValue:function(t){if(this._clearGallery(),t.length>0){this.container.removeClass("empty"),this.mediaGallery.html("");for(var i=[],e=0;e<t.length;e++)i.push(t[e].id),this._createThumbnail(t[e]);this.input.val(JSON.stringify(i))}},_createThumbnail:function(t){var i=$('<li data-id="'+t.id+'"><i class="icon-cancel"></i></li>');$('<img src="'+t.thumbnail.attr("src")+'" alt="'+html_entities(t.name)+'">').appendTo(i),this.mediaGallery.append(i)}},t.Gallery=i}(window),function(t){"use strict";function i(t,i){this.type="document",this.el=t,this.library=i,this.container=this.el.find(".form-media-container"),this.input=this.el.find('input[type="hidden"]'),this.addButton=this.el.find(".button-add"),this.removeButton=this.el.find(".button-clear"),this.thumbnail=this.el.find(".form-document-thumbnail span"),this.fileName=this.el.find(".form-document-name"),this.filter=this.el.data("filter"),this._initEvents()}i.prototype={_initEvents:function(){var t=this;this.removeButton.on("click",function(i){t._removeDocument(),i.preventDefault(),i.stopPropagation()}),this.addButton.on("click",function(i){t.library.run(t),i.preventDefault(),i.stopPropagation()})},_removeDocument:function(){this.input.val(""),this.thumbnail.attr("src",""),this.fileName.text(""),this.container.addClass("empty")},getValue:function(){return this.input.val()},setValue:function(t){null!==t?(this.container.removeClass("empty"),this.input.val(t.id),this.fileName.text(t.name),this.thumbnail.html(t.thumbnail)):this._removeDocument()}},t.Document=i}(window),function(t){"use strict";function i(t,i){this.el=t,this.single="undefined"==typeof i?!1:i,this._init()}i.prototype={_init:function(){this.container=this.el.find(".form-nodes-container"),this.sortable=this.container.find("ul.form-items-list-sortable"),this.results=this.container.find("ul.form-items-list-results"),this.search=this.container.find('input[name="_nodesearch"]'),this.valueInput=this.container.find('input[type="hidden"]'),this.parent=this.el.closest(".form-group"),this.searchurl=this.el.find(".form-items-search").data("searchurl"),this.filter=this.el.find(".form-items-search").data("nodetype"),this.searching=!1,this._extractValue(),this.initEvents()},_extractValue:function(){var t=this.valueInput.val().trim();this.nodes=[],""!=t.trim()&&(this.single?this.nodes.push(parseInt(t)):this.nodes=JSON.parse(t))},initEvents:function(){var t=this;this.search.bind("keydown",function(i){var e=$(this).val().trim(),s=$(this);return 27==i.which?(i.stopPropagation(),""===e?s.blur():s.val(""),void t._clearSearch()):(13==i.which&&i.preventDefault(),!t.searching&&e.length>0&&t._search(e),void(""==e&&t._clearSearch()))}),this.search.on("focus",function(){t._showResults()}),this.results.on("click","li",function(){t._addToSortable($(this))}),this.sortable.on("click","i.icon-cancel",function(i){i.stopPropagation(),t._removeNode($(this).parent())}),$("body").click(function(){t._hideResults()}),this.parent.click(function(t){t.stopPropagation()}),this.single||$(this.sortable).sortable({tolerance:"pointer",placeholder:"placeholder",opacity:.7,delay:50,stop:function(){t._regenerateValue()}}).disableSelection()},_search:function(t){var i=this;i.searching||$.post(this.searchurl,{q:t,filter:i.filter},function(t){i._populateResults(t)})},_populateResults:function(t){this.results.empty();for(var i in t)if(-1==this.nodes.indexOf(parseInt(i))){var e=this._createListItem(i,t[i]);this.results.append(e)}},_createListItem:function(t,i){return $('<li data-id="'+t+'">'+i+"</li>")},_addToSortable:function(t){t.append('<i class="icon-cancel"></i>'),this.single&&(this.sortable.empty(),this.nodes=[]),this.sortable.append(t),this.nodes.push(t.data("id")),this._regenerateValue(),this._clearSearch()},_removeNode:function(t){var i=this.nodes.indexOf(t.data("id"));delete this.nodes[i],t.remove(),this._regenerateValue()},_regenerateValue:function(){this.container.removeClass("empty"),0==count(this.nodes)&&this.container.addClass("empty");var t="";if(this.single){var i=this.sortable.find("li:first-child");1==i.length&&(t=i.data("id"))}else{for(var e=[],s=this.sortable.find("li"),n=0;n<s.length;n++)e.push($(s[n]).data("id"));t=JSON.stringify(e)}this.valueInput.val(t)},_clearSearch:function(){this.results.empty(),this.search.val("")},_showResults:function(){this.results.removeClass("hidden")},_hideResults:function(){this.results.addClass("hidden")}},t.NodeCollection=i}(window),function(t){"use strict";function i(t,i,e){this._init(t,i,e)}function e(){this._init()}function s(t,i){this._init(t,i)}function n(t,i){this._init(t,i)}i.prototype={_init:function(t,i,e){this.el=t,this.editorContainer=t.find(".markdown-editor-container"),this.text=this.el.find("textarea"),this.library=i,this.dialog=e,this.enabled=!0,this.previewurl=this.editorContainer.data("previewurl"),this.requestingPreview=!1,this.markdownPreviewContainer=t.find(".markdown-preview-container"),this.markdownPreview=this.markdownPreviewContainer.find(".markdown-body"),this.cursorStart=null,this.toolbar=this.el.find(".markdown-editor-toolbar"),this._controls(),this._initEvents()},_initEvents:function(){var i=this;this.text.height(0).height(this.text.prop("scrollHeight")+"px"),this.text.on("propertychange input change keyup keydown paste cut",function(){i.resize()}).change(),$(t).resize(function(){i.delayedResize()}),this.text.on("keydown",function(t){9===t.keyCode&&(t.stopPropagation(),t.preventDefault(),t.shiftKey&&9===t.keyCode?i.flush(t):i.indent(t))}),this.toolbar.on("click",".toolset li",function(){if(!i.enabled)return!1;var t=$(this).data("method");return i.controls[t]&&i.controls[t](),!1}),this.markdownPreviewContainer.find(".markdown-hide-preview").click(function(){i._hidePreview()})},_getGalleryController:function(){return new s(this,this.library)},_getDocumentController:function(){return new n(this,this.library)},resize:function(){var t=Math.max($("body").prop("scrollTop"),$("html").prop("scrollTop"));this.text.height(0).height(this.text.prop("scrollHeight")+"px"),$("html,body").prop("scrollTop",t)},delayedResize:function(){var t=this;setTimeout(function(){t.resize()},0)},insert:function(t){var i=this.text[0],e=i.selectionStart,s=i.value;i.value=s.substring(0,e)+t+s.substring(e),i.selectionEnd=e+t.length,this.resize()},insertAt:function(t,i){var e=this.text[0],s=e.value;e.value=s.substring(0,i)+t+s.substring(i),e.selectionStart=i,e.selectionEnd=i+t.length,this.resize()},deleteSelection:function(){var t=this.text[0],i=t.selectionStart,e=t.selectionEnd,s=t.value;t.value=s.substring(0,i)+s.substring(e),this.resize()},wrap:function(t,i){var e=this.text[0],s=e.selectionStart,n=e.selectionEnd,a=e.value;e.value=a.substring(0,s)+t+a.substring(s,n)+i+a.substring(n),e.selectionStart=s,e.selectionEnd=n+t.length+i.length,this.resize()},indent:function(t){for(var i=this.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a=n.substring(e,s).split("\n"),o=0;o<a.length;o++)a[o]="	"+a[o];i.value=n.substring(0,e)+a.join("\n")+n.substring(s),s>e?(i.selectionStart=e,i.selectionEnd=s+a.length):i.selectionStart=i.selectionEnd=e+1,this.resize()},flush:function(t){var i=this.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a=new RegExp(/^[\t]{1}/),o=0;if(e===s){for(;e>0;){if("\n"===n.charAt(e)){e++;break}e--}var r=n.substring(e,s),l=r.match(a);l&&(i.value=n.substring(0,e)+r.replace(a,"")+n.substring(s),s--),i.selectionStart=i.selectionEnd=s}else{for(var c=n.substring(e,s).split("\n"),h=0;h<c.length;h++)c[h].match(a)&&(o++,c[h]=c[h].replace(a,""));i.value=n.substring(0,e)+c.join("\n")+n.substring(s),i.selectionStart=e,i.selectionEnd=s-o}this.resize()},_showPreview:function(t){this.editorContainer.addClass("preview"),this.markdownPreview.html(t)},_hidePreview:function(){this.editorContainer.removeClass("preview"),this.markdownPreview.html(""),this.requestingPreview=!1,this._enable()},_enable:function(){this.enabled=!0,this.text.removeAttr("disabled"),this.text.removeClass("disabled"),this.toolbar.removeClass("disabled")},_disable:function(){this.enabled=!1,this.text.attr("disabled","disabled"),this.text.addClass("disabled"),this.toolbar.addClass("disabled")},_controls:function(){var t=this;this.controls={bold:function(){t.wrap("**","**")},italic:function(){t.wrap("*","*")},code:function(){t.wrap("`","`")},link:function(){var i=t.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a=n.substring(e,s);t.cursorStart=e,t.dialog.run(t,"link"),t.dialog.textInput.val(a),t.dialog.urlInput.focus()},list:function(){for(var i=t.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a=n.substring(e,s).split("\n"),o=0;o<a.length;o++)a[o]="* "+a[o];i.value=n.substring(0,e)+"\n"+a.join("\n")+"\n"+n.substring(s),t.resize()},quote:function(){for(var i=t.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a=n.substring(e,s).split("\n"),o=0;o<a.length;o++)a[o]="> "+a[o];i.value=n.substring(0,e)+a.join("\n")+n.substring(s),t.resize()},heading:function(){t.wrap("###","")},hrule:function(){var i=t.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a="\n***\n";i.value=n.substring(0,e)+a+n.substring(s),i.selectionStart=i.selectionEnd=s+a.length,t.resize()},readmore:function(){var i=t.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a="\n![READMORE]!\n";i.value=n.substring(0,e)+a+n.substring(s),i.selectionStart=i.selectionEnd=s+a.length,t.resize()},media:function(){var i=t.text[0],e=i.selectionStart,s=i.selectionEnd,n=i.value,a=n.substring(e,s);t.dialog.run(t,"library"),t.dialog.sourceInput.val(a),t.resize()},preview:function(){t.requestingPreview||(t.requestingPreview=!0,t._disable(),$.post(t.previewurl,{text:t.text[0].value},function(i){t._showPreview(i)}))}}}},t.Editor=i,e.prototype={_init:function(){var t=this;this.dialog=new Modal($("#modalEditor"),{onConfirmEvent:function(i){"undefined"!=typeof t.controller&&null!==t.controller&&(t._setValue(),this.controller=null,this.mode=null)}}),this.controller=null,this.mode=null,this.container=this.dialog.el.find(".modal"),this.libraryDialog=this.container.find(".editor-modal-library"),this.linkDialog=this.container.find(".editor-modal-link"),this.galleryButton=this.libraryDialog.find(".editor-modal-gallery-button"),this.mediaButton=this.libraryDialog.find(".editor-modal-document-button"),this.sourceInput=this.libraryDialog.find('input[name="_src"]'),this.alttextInput=this.libraryDialog.find('input[name="_alt"]'),this.urlInput=this.linkDialog.find('input[name="_link"]'),this.textInput=this.linkDialog.find('input[name="_text"]'),this._initEvents()},_initEvents:function(){var t=this;this.galleryButton.on("click",function(i){t.dialog.closeModal();var e=t.controller._getGalleryController();e.run(),i.preventDefault(),i.stopPropagation()}),this.mediaButton.on("click",function(i){t.dialog.closeModal();var e=t.controller._getDocumentController();e.run(),i.preventDefault(),i.stopPropagation()})},run:function(t,i){this.setMode(i),this.controller=t,this._reset(),this.dialog.openModal()},setMode:function(t){this.mode=t,this.container.removeClass("library link"),this.container.addClass(t)},_reset:function(){this.sourceInput.val(""),this.alttextInput.val(""),this.urlInput.val(""),this.textInput.val("")},_setValue:function(){this.controller.deleteSelection(),"library"===this.mode?this._setValueLibrary():"link"===this.mode&&this._setValueLink()},_setValueLink:function(){var t=this.urlInput.val();"#"!==t.slice(0,1)&&(t=add_http(t));var i=this.textInput.val().length>0?this.textInput.val():this.urlInput.val(),e="["+i+"]("+t+")";this.controller.insertAt(e,this.controller.cursorStart)},_setValueLibrary:function(){this.controller.insert("!["+this.alttextInput.val()+"]("+this.sourceInput.val()+")")}},t.EditorDialog=e,s.prototype={_init:function(t,i){this.library=i,this.type="gallery",this.controller=t},run:function(){this.library.run(this)},getValue:function(){return""},setValue:function(t){for(var i=[],e=0;e<t.length;e++)i.push(t[e].id);this.controller.insert('\n[gallery ids="'+i.join(",")+'"]\n')}},t.EditorGallery=s,n.prototype={_init:function(t,i){this.library=i,this.type="document",this.controller=t},run:function(){this.library.run(this)},getValue:function(){return""},setValue:function(t){this.controller.insert('\n[document id="'+t.id+'"]\n')}},t.EditorDocument=n}(window),$(".form-group input, .form-group textarea").focus(function(){$(this).closest(".form-group").addClass("focus")}),$(".form-group input, .form-group textarea").blur(function(){$(this).closest(".form-group").removeClass("focus")}),$(".form-group-password").each(function(){new Meter($(this))}),$(".form-group-slug").each(function(){new Slug($(this))}),$(".form-group-tag").each(function(){new TagLegacy($(this))}),$("input.minicolors").minicolors(),window.documentsLibrary=new Library($("#library-modal-container")),$(".form-group-gallery").each(function(){new Gallery($(this),window.documentsLibrary)}),$(".form-group-document").each(function(){new Document($(this),window.documentsLibrary)}),$(".form-group-node-collection").each(function(){new NodeCollection($(this))}),$(".form-group-node").each(function(){new NodeCollection($(this),!0)}),window.editorDialog=new EditorDialog,$(".form-group-markdown").each(function(){new Editor($(this),window.documentsLibrary,window.editorDialog)}),$("button.publish-save").on("click",function(t){t.preventDefault(),t.stopPropagation();var i=$(this).closest("form");$('<input name="_publish" type="hidden" value="publish">').appendTo(i),i.submit()}),$(".node-option-formable").on("click",function(t){t.preventDefault(),t.stopPropagation();var i=create_form_from($(this));append_and_submit_form(i)});