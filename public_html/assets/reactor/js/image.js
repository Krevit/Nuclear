!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"undefined"==typeof t}function s(t,e){var s=[];return i(e)&&s.push(e),s.slice.apply(t,s)}function o(t,i){var e=s(arguments,2);return function(){return t.apply(i,e.concat(s(arguments)))}}function a(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==b.protocol||i[2]!==b.hostname||i[3]!==b.port)}function n(t){var i="timestamp="+(new Date).getTime();return t+(t.indexOf("?")===-1?"?":"&")+i}function h(t){return t?' crossOrigin="'+t+'"':""}function r(t,i){var e;return t.naturalWidth&&!mt?i(t.naturalWidth,t.naturalHeight):(e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function c(t){var e=[],s=t.rotate,o=t.scaleX,a=t.scaleY;return i(s)&&0!==s&&e.push("rotate("+s+"deg)"),i(o)&&1!==o&&e.push("scaleX("+o+")"),i(a)&&1!==a&&e.push("scaleY("+a+")"),e.length?e.join(" "):"none"}function l(t,i){var e,s,o=bt(t.degree)%180,a=(o>90?180-o:o)*Math.PI/180,n=Ct(a),h=Bt(a),r=t.width,c=t.height,l=t.aspectRatio;return i?(e=r/(h+n/l),s=e/l):(e=r*h+c*n,s=r*n+c*h),{width:e,height:s}}function p(e,s){var o,a,n,h=t("<canvas>")[0],r=h.getContext("2d"),c=0,p=0,d=s.naturalWidth,g=s.naturalHeight,u=s.rotate,f=s.scaleX,m=s.scaleY,v=i(f)&&i(m)&&(1!==f||1!==m),w=i(u)&&0!==u,x=w||v,b=d*bt(f||1),C=g*bt(m||1);return v&&(o=b/2,a=C/2),w&&(n=l({width:b,height:C,degree:u}),b=n.width,C=n.height,o=b/2,a=C/2),h.width=b,h.height=C,x&&(c=-d/2,p=-g/2,r.save(),r.translate(o,a)),w&&r.rotate(u*Math.PI/180),v&&r.scale(f,m),r.drawImage(e,Dt(c),Dt(p),Dt(d),Dt(g)),x&&r.restore(),h}function d(i){var e=i.length,s=0,o=0;return e&&(t.each(i,function(t,i){s+=i.pageX,o+=i.pageY}),s/=e,o/=e),{pageX:s,pageY:o}}function g(t,i,e){var s,o="";for(s=i,e+=i;s<e;s++)o+=kt(t.getUint8(s));return o}function u(t){var i,e,s,o,a,n,h,r,c,l,p=new $(t),d=p.byteLength;if(255===p.getUint8(0)&&216===p.getUint8(1))for(c=2;c<d;){if(255===p.getUint8(c)&&225===p.getUint8(c+1)){h=c;break}c++}if(h&&(e=h+4,s=h+10,"Exif"===g(p,e,4)&&(n=p.getUint16(s),a=18761===n,(a||19789===n)&&42===p.getUint16(s+2,a)&&(o=p.getUint32(s+4,a),o>=8&&(r=s+o)))),r)for(d=p.getUint16(r,a),l=0;l<d;l++)if(c=r+12*l+2,274===p.getUint16(c,a)){c+=8,i=p.getUint16(c,a),mt&&p.setUint16(c,1,a);break}return i}function f(t){var i,e=t.replace(Q,""),s=atob(e),o=s.length,a=new B(o),n=new y(a);for(i=0;i<o;i++)n[i]=s.charCodeAt(i);return a}function m(t){var i,e=new y(t),s=e.length,o="";for(i=0;i<s;i++)o+=kt(e[i]);return"data:image/jpeg;base64,"+D(o)}function v(i,e){this.$element=t(i),this.options=t.extend({},v.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var w=t(window),x=t(document),b=window.location,C=window.navigator,B=window.ArrayBuffer,y=window.Uint8Array,$=window.DataView,D=window.btoa,k="cropper",M="cropper-modal",L="cropper-hide",W="cropper-hidden",X="cropper-invisible",Y="cropper-move",T="cropper-crop",H="cropper-disabled",z="cropper-bg",R="mousedown touchstart pointerdown MSPointerDown",_="mousemove touchmove pointermove MSPointerMove",I="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",E="wheel mousewheel DOMMouseScroll",O="dblclick",P="load."+k,U="error."+k,F="resize."+k,j="build."+k,A="built."+k,S="cropstart."+k,N="cropmove."+k,q="cropend."+k,V="crop."+k,K="zoom."+k,Z=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,G=/^data:/,Q=/^data:([^;]+);base64,/,J=/^data:image\/jpeg.*;base64,/,tt="preview",it="action",et="e",st="w",ot="s",at="n",nt="se",ht="sw",rt="ne",ct="nw",lt="all",pt="crop",dt="move",gt="zoom",ut="none",ft=t.isFunction(t("<canvas>")[0].getContext),mt=C&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(C.userAgent),vt=Number,wt=Math.min,xt=Math.max,bt=Math.abs,Ct=Math.sin,Bt=Math.cos,yt=Math.sqrt,$t=Math.round,Dt=Math.floor,kt=String.fromCharCode;v.prototype={constructor:v,init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&ft&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var s=t.Event(i,e);return this.$element.trigger(s),s},load:function(i){var e,s,o=this.options,h=this.$element;if(i&&(h.one(j,o.build),!this.trigger(j).isDefaultPrevented())){if(this.url=i,this.image={},!o.checkOrientation||!B)return this.clone();if(e=t.proxy(this.read,this),G.test(i))return J.test(i)?e(f(i)):this.clone();s=new XMLHttpRequest,s.onerror=s.onabort=t.proxy(function(){this.clone()},this),s.onload=function(){e(this.response)},o.checkCrossOrigin&&a(i)&&h.prop("crossOrigin")&&(i=n(i)),s.open("get",i),s.responseType="arraybuffer",s.send()}},read:function(t){var i=this.options,e=u(t),s=this.image,o=0,a=1,n=1;if(e>1)switch(this.url=m(t),e){case 2:a=-1;break;case 3:o=-180;break;case 4:n=-1;break;case 5:o=90,n=-1;break;case 6:o=90;break;case 7:o=90,a=-1;break;case 8:o=-90}i.rotatable&&(s.rotate=o),i.scalable&&(s.scaleX=a,s.scaleY=n),this.clone()},clone:function(){var i,e,s=this.options,o=this.$element,r=this.url,c="";s.checkCrossOrigin&&a(r)&&(c=o.prop("crossOrigin"),c?i=r:(c="anonymous",i=n(r))),this.crossOrigin=c,this.crossOriginUrl=i,this.$clone=e=t("<img"+h(c)+' src="'+(i||r)+'">'),this.isImg?o[0].complete?this.start():o.one(P,t.proxy(this.start,this)):e.one(P,t.proxy(this.start,this)).one(U,t.proxy(this.stop,this)).addClass(L).insertAfter(o)},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(U,this.stop),i=e),r(i[0],t.proxy(function(i,e){t.extend(this.image,{naturalWidth:i,naturalHeight:e,aspectRatio:i/e}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var i,e,s,o=this.options,a=this.$element,n=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=a.parent(),this.$cropper=i=t(v.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(n),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=s=e.find(".cropper-face"),a.addClass(W).after(i),this.isImg||n.removeClass(L),this.initPreview(),this.bind(),o.aspectRatio=xt(0,o.aspectRatio)||NaN,o.viewMode=xt(0,wt(3,$t(o.viewMode)))||0,o.autoCrop?(this.isCropped=!0,o.modal&&this.$dragBox.addClass(M)):e.addClass(W),o.guides||e.find(".cropper-dashed").addClass(W),o.center||e.find(".cropper-center").addClass(W),o.cropBoxMovable&&s.addClass(Y).data(it,lt),o.highlight||s.addClass(X),o.background&&i.addClass(z),o.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(W),this.setDragMode(o.dragMode),this.render(),this.isBuilt=!0,this.setData(o.data),a.one(A,o.built),setTimeout(t.proxy(function(){this.trigger(A),this.trigger(V,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,s=this.$cropper;s.addClass(W),i.removeClass(W),s.css(this.container={width:xt(e.width(),vt(t.minContainerWidth)||200),height:xt(e.height(),vt(t.minContainerHeight)||100)}),i.addClass(W),s.removeClass(W)},initCanvas:function(){var i,e=this.options.viewMode,s=this.container,o=s.width,a=s.height,n=this.image,h=n.naturalWidth,r=n.naturalHeight,c=90===bt(n.rotate),l=c?r:h,p=c?h:r,d=l/p,g=o,u=a;a*d>o?3===e?g=a*d:u=o/d:3===e?u=o/d:g=a*d,i={naturalWidth:l,naturalHeight:p,aspectRatio:d,width:g,height:u},i.oldLeft=i.left=(o-g)/2,i.oldTop=i.top=(a-u)/2,this.canvas=i,this.isLimited=1===e||2===e,this.limitCanvas(!0,!0),this.initialImage=t.extend({},n),this.initialCanvas=t.extend({},i)},limitCanvas:function(t,i){var e,s,o,a,n=this.options,h=n.viewMode,r=this.container,c=r.width,l=r.height,p=this.canvas,d=p.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=vt(n.minCanvasWidth)||0,s=vt(n.minCanvasHeight)||0,h&&(h>1?(e=xt(e,c),s=xt(s,l),3===h&&(s*d>e?e=s*d:s=e/d)):e?e=xt(e,u?g.width:0):s?s=xt(s,u?g.height:0):u&&(e=g.width,s=g.height,s*d>e?e=s*d:s=e/d)),e&&s?s*d>e?s=e/d:e=s*d:e?s=e/d:s&&(e=s*d),p.minWidth=e,p.minHeight=s,p.maxWidth=1/0,p.maxHeight=1/0),i&&(h?(o=c-p.width,a=l-p.height,p.minLeft=wt(0,o),p.minTop=wt(0,a),p.maxLeft=xt(0,o),p.maxTop=xt(0,a),u&&this.isLimited&&(p.minLeft=wt(g.left,g.left+g.width-p.width),p.minTop=wt(g.top,g.top+g.height-p.height),p.maxLeft=g.left,p.maxTop=g.top,2===h&&(p.width>=c&&(p.minLeft=wt(0,o),p.maxLeft=xt(0,o)),p.height>=l&&(p.minTop=wt(0,a),p.maxTop=xt(0,a))))):(p.minLeft=-p.width,p.minTop=-p.height,p.maxLeft=c,p.maxTop=l))},renderCanvas:function(t){var i,e,s=this.canvas,o=this.image,a=o.rotate,n=o.naturalWidth,h=o.naturalHeight;this.isRotated&&(this.isRotated=!1,e=l({width:o.width,height:o.height,degree:a}),i=e.width/e.height,i!==s.aspectRatio&&(s.left-=(e.width-s.width)/2,s.top-=(e.height-s.height)/2,s.width=e.width,s.height=e.height,s.aspectRatio=i,s.naturalWidth=n,s.naturalHeight=h,a%180&&(e=l({width:n,height:h,degree:a}),s.naturalWidth=e.width,s.naturalHeight=e.height),this.limitCanvas(!0,!1))),(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=wt(xt(s.width,s.minWidth),s.maxWidth),s.height=wt(xt(s.height,s.minHeight),s.maxHeight),this.limitCanvas(!1,!0),s.oldLeft=s.left=wt(xt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=wt(xt(s.top,s.minTop),s.maxTop),this.$canvas.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,s=this.canvas,o=this.image;o.rotate&&(e=l({width:s.width,height:s.height,degree:o.rotate,aspectRatio:o.aspectRatio},!0)),t.extend(o,e?{width:e.width,height:e.height,left:(s.width-e.width)/2,top:(s.height-e.height)/2}:{width:s.width,height:s.height,left:0,top:0}),this.$clone.css({width:o.width,height:o.height,marginLeft:o.left,marginTop:o.top,transform:c(o)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,s=i.aspectRatio,o=vt(i.autoCropArea)||.8,a={width:e.width,height:e.height};s&&(e.height*s>e.width?a.height=a.width/s:a.width=a.height*s),this.cropBox=a,this.limitCropBox(!0,!0),a.width=wt(xt(a.width,a.minWidth),a.maxWidth),a.height=wt(xt(a.height,a.minHeight),a.maxHeight),a.width=xt(a.minWidth,a.width*o),a.height=xt(a.minHeight,a.height*o),a.oldLeft=a.left=e.left+(e.width-a.width)/2,a.oldTop=a.top=e.top+(e.height-a.height)/2,this.initialCropBox=t.extend({},a)},limitCropBox:function(t,i){var e,s,o,a,n=this.options,h=n.aspectRatio,r=this.container,c=r.width,l=r.height,p=this.canvas,d=this.cropBox,g=this.isLimited;t&&(e=vt(n.minCropBoxWidth)||0,s=vt(n.minCropBoxHeight)||0,e=wt(e,c),s=wt(s,l),o=wt(c,g?p.width:c),a=wt(l,g?p.height:l),h&&(e&&s?s*h>e?s=e/h:e=s*h:e?s=e/h:s&&(e=s*h),a*h>o?a=o/h:o=a*h),d.minWidth=wt(e,o),d.minHeight=wt(s,a),d.maxWidth=o,d.maxHeight=a),i&&(g?(d.minLeft=xt(0,p.left),d.minTop=xt(0,p.top),d.maxLeft=wt(c,p.left+p.width)-d.width,d.maxTop=wt(l,p.top+p.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=c-d.width,d.maxTop=l-d.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,s=i.height,o=this.cropBox;(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=wt(xt(o.width,o.minWidth),o.maxWidth),o.height=wt(xt(o.height,o.minHeight),o.maxHeight),this.limitCropBox(!1,!0),o.oldLeft=o.left=wt(xt(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=wt(xt(o.top,o.minTop),o.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(it,o.width===e&&o.height===s?dt:lt),this.$cropBox.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(V,this.getData())},initPreview:function(){var i,e=h(this.crossOrigin),s=e?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=i=t("<img"+e+' src="'+s+'">'),this.$viewBox.html(i),this.$preview.each(function(){var i=t(this);i.data(tt,{width:i.width(),height:i.height(),html:i.html()}),i.html("<img"+e+' src="'+s+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(tt);i.css({width:e.width,height:e.height}).html(e.html).removeData(tt)})},preview:function(){var i=this.image,e=this.canvas,s=this.cropBox,o=s.width,a=s.height,n=i.width,h=i.height,r=s.left-e.left-i.left,l=s.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:n,height:h,marginLeft:-r,marginTop:-l,transform:c(i)}),this.$preview.each(function(){var e=t(this),s=e.data(tt),p=s.width,d=s.height,g=p,u=d,f=1;o&&(f=p/o,u=a*f),a&&u>d&&(f=d/a,g=o*f,u=d),e.css({width:g,height:u}).find("img").css({width:n*f,height:h*f,marginLeft:-r*f,marginTop:-l*f,transform:c(i)})}))},bind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.on(S,i.cropstart),t.isFunction(i.cropmove)&&e.on(N,i.cropmove),t.isFunction(i.cropend)&&e.on(q,i.cropend),t.isFunction(i.crop)&&e.on(V,i.crop),t.isFunction(i.zoom)&&e.on(K,i.zoom),s.on(R,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&s.on(E,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&s.on(O,t.proxy(this.dblclick,this)),x.on(_,this._cropMove=o(this.cropMove,this)).on(I,this._cropEnd=o(this.cropEnd,this)),i.responsive&&w.on(F,this._resize=o(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,s=this.$cropper;t.isFunction(i.cropstart)&&e.off(S,i.cropstart),t.isFunction(i.cropmove)&&e.off(N,i.cropmove),t.isFunction(i.cropend)&&e.off(q,i.cropend),t.isFunction(i.crop)&&e.off(V,i.crop),t.isFunction(i.zoom)&&e.off(K,i.zoom),s.off(R,this.cropStart),i.zoomable&&i.zoomOnWheel&&s.off(E,this.wheel),i.toggleDragModeOnDblclick&&s.off(O,this.dblclick),x.off(_,this._cropMove).off(I,this._cropEnd),i.responsive&&w.off(F,this._resize)},resize:function(){var i,e,s,o=this.options.restore,a=this.$container,n=this.container;!this.isDisabled&&n&&(s=a.width()/n.width,1===s&&a.height()===n.height||(o&&(i=this.getCanvasData(),e=this.getCropBoxData()),this.render(),o&&(this.setCanvasData(t.each(i,function(t,e){i[t]=e*s})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*s})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(T)?this.setDragMode(dt):this.setDragMode(pt))},wheel:function(i){var e=i.originalEvent||i,s=vt(this.options.wheelZoomRatio)||.1,o=1;this.isDisabled||(i.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),e.deltaY?o=e.deltaY>0?1:-1:e.wheelDelta?o=-e.wheelDelta/120:e.detail&&(o=e.detail>0?1:-1),this.zoom(-o*s,i)))},cropStart:function(i){var e,s,o=this.options,a=i.originalEvent,n=a&&a.touches,h=i;if(!this.isDisabled){if(n){if(e=n.length,e>1){if(!o.zoomable||!o.zoomOnTouch||2!==e)return;h=n[1],this.startX2=h.pageX,this.startY2=h.pageY,s=gt}h=n[0]}if(s=s||t(h.target).data(it),Z.test(s)){if(this.trigger(S,{originalEvent:a,action:s}).isDefaultPrevented())return;i.preventDefault(),this.action=s,this.cropping=!1,this.startX=h.pageX||a&&a.pageX,this.startY=h.pageY||a&&a.pageY,s===pt&&(this.cropping=!0,this.$dragBox.addClass(M))}}},cropMove:function(t){var i,e=this.options,s=t.originalEvent,o=s&&s.touches,a=t,n=this.action;if(!this.isDisabled){if(o){if(i=o.length,i>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;a=o[1],this.endX2=a.pageX,this.endY2=a.pageY}a=o[0]}if(n){if(this.trigger(N,{originalEvent:s,action:n}).isDefaultPrevented())return;t.preventDefault(),this.endX=a.pageX||s&&s.pageX,this.endY=a.pageY||s&&s.pageY,this.change(a.shiftKey,n===gt?t:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(M,this.isCropped&&this.options.modal)),this.action="",this.trigger(q,{originalEvent:i,action:e}))},change:function(t,i){var e,s,o=this.options,a=o.aspectRatio,n=this.action,h=this.container,r=this.canvas,c=this.cropBox,l=c.width,p=c.height,d=c.left,g=c.top,u=d+l,f=g+p,m=0,v=0,w=h.width,x=h.height,b=!0;switch(!a&&t&&(a=l&&p?l/p:1),this.isLimited&&(m=c.minLeft,v=c.minTop,w=m+wt(h.width,r.left+r.width),x=v+wt(h.height,r.top+r.height)),s={x:this.endX-this.startX,y:this.endY-this.startY},a&&(s.X=s.y*a,s.Y=s.x/a),n){case lt:d+=s.x,g+=s.y;break;case et:if(s.x>=0&&(u>=w||a&&(g<=v||f>=x))){b=!1;break}l+=s.x,a&&(p=l/a,g-=s.Y/2),l<0&&(n=st,l=0);break;case at:if(s.y<=0&&(g<=v||a&&(d<=m||u>=w))){b=!1;break}p-=s.y,g+=s.y,a&&(l=p*a,d+=s.X/2),p<0&&(n=ot,p=0);break;case st:if(s.x<=0&&(d<=m||a&&(g<=v||f>=x))){b=!1;break}l-=s.x,d+=s.x,a&&(p=l/a,g+=s.Y/2),l<0&&(n=et,l=0);break;case ot:if(s.y>=0&&(f>=x||a&&(d<=m||u>=w))){b=!1;break}p+=s.y,a&&(l=p*a,d-=s.X/2),p<0&&(n=at,p=0);break;case rt:if(a){if(s.y<=0&&(g<=v||u>=w)){b=!1;break}p-=s.y,g+=s.y,l=p*a}else s.x>=0?u<w?l+=s.x:s.y<=0&&g<=v&&(b=!1):l+=s.x,s.y<=0?g>v&&(p-=s.y,g+=s.y):(p-=s.y,g+=s.y);l<0&&p<0?(n=ht,p=0,l=0):l<0?(n=ct,l=0):p<0&&(n=nt,p=0);break;case ct:if(a){if(s.y<=0&&(g<=v||d<=m)){b=!1;break}p-=s.y,g+=s.y,l=p*a,d+=s.X}else s.x<=0?d>m?(l-=s.x,d+=s.x):s.y<=0&&g<=v&&(b=!1):(l-=s.x,d+=s.x),s.y<=0?g>v&&(p-=s.y,g+=s.y):(p-=s.y,g+=s.y);l<0&&p<0?(n=nt,p=0,l=0):l<0?(n=rt,l=0):p<0&&(n=ht,p=0);break;case ht:if(a){if(s.x<=0&&(d<=m||f>=x)){b=!1;break}l-=s.x,d+=s.x,p=l/a}else s.x<=0?d>m?(l-=s.x,d+=s.x):s.y>=0&&f>=x&&(b=!1):(l-=s.x,d+=s.x),s.y>=0?f<x&&(p+=s.y):p+=s.y;l<0&&p<0?(n=rt,p=0,l=0):l<0?(n=nt,l=0):p<0&&(n=ct,p=0);break;case nt:if(a){if(s.x>=0&&(u>=w||f>=x)){b=!1;break}l+=s.x,p=l/a}else s.x>=0?u<w?l+=s.x:s.y>=0&&f>=x&&(b=!1):l+=s.x,s.y>=0?f<x&&(p+=s.y):p+=s.y;l<0&&p<0?(n=ct,p=0,l=0):l<0?(n=ht,l=0):p<0&&(n=rt,p=0);break;case dt:this.move(s.x,s.y),b=!1;break;case gt:this.zoom(function(t,i,e,s){var o=yt(t*t+i*i),a=yt(e*e+s*s);return(a-o)/o}(bt(this.startX-this.startX2),bt(this.startY-this.startY2),bt(this.endX-this.endX2),bt(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case pt:if(!s.x||!s.y){b=!1;break}e=this.$cropper.offset(),d=this.startX-e.left,g=this.startY-e.top,l=c.minWidth,p=c.minHeight,s.x>0?n=s.y>0?nt:rt:s.x<0&&(d-=l,n=s.y>0?ht:ct),s.y<0&&(g-=p),this.isCropped||(this.$cropBox.removeClass(W),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}b&&(c.width=l,c.height=p,c.left=d,c.top=g,this.action=n,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(M),this.$cropBox.removeClass(W)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(M),this.$cropBox.addClass(W))},replace:function(t,i){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(H))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(H))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(W)):this.isImg?t.off(P,this.start):this.$clone&&this.$clone.remove(),t.removeData(k)},move:function(t,i){var s=this.canvas;this.moveTo(e(t)?t:s.left+vt(t),e(i)?i:s.top+vt(i))},moveTo:function(t,s){var o=this.canvas,a=!1;e(s)&&(s=t),t=vt(t),s=vt(s),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(o.left=t,a=!0),i(s)&&(o.top=s,a=!0),a&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=vt(t),t=t<0?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,s,o,a,n,h=this.options,r=this.canvas,c=r.width,l=r.height,p=r.naturalWidth,g=r.naturalHeight;if(t=vt(t),t>=0&&this.isBuilt&&!this.isDisabled&&h.zoomable){if(s=p*t,o=g*t,i&&(e=i.originalEvent),this.trigger(K,{originalEvent:e,oldRatio:c/p,ratio:s/p}).isDefaultPrevented())return;e?(a=this.$cropper.offset(),n=e.touches?d(e.touches):{pageX:i.pageX||e.pageX||0,pageY:i.pageY||e.pageY||0},r.left-=(s-c)*((n.pageX-a.left-r.left)/c),r.top-=(o-l)*((n.pageY-a.top-r.top)/l)):(r.left-=(s-c)/2,r.top-=(o-l)/2),r.width=s,r.height=o,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+vt(t))},rotateTo:function(t){t=vt(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,s){var o=this.image,a=!1;e(s)&&(s=t),t=vt(t),s=vt(s),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(o.scaleX=t,a=!0),i(s)&&(o.scaleY=s,a=!0),a&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,s,o=this.options,a=this.image,n=this.canvas,h=this.cropBox;return this.isBuilt&&this.isCropped?(s={x:h.left-n.left,y:h.top-n.top,width:h.width,height:h.height},e=a.width/a.naturalWidth,t.each(s,function(t,o){o/=e,s[t]=i?$t(o):o})):s={x:0,y:0,width:0,height:0},o.rotatable&&(s.rotate=a.rotate||0),o.scalable&&(s.scaleX=a.scaleX||1,s.scaleY=a.scaleY||1),s},setData:function(e){var s,o,a,n=this.options,h=this.image,r=this.canvas,c={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(n.rotatable&&i(e.rotate)&&e.rotate!==h.rotate&&(h.rotate=e.rotate,this.isRotated=s=!0),n.scalable&&(i(e.scaleX)&&e.scaleX!==h.scaleX&&(h.scaleX=e.scaleX,o=!0),i(e.scaleY)&&e.scaleY!==h.scaleY&&(h.scaleY=e.scaleY,o=!0)),s?this.renderCanvas():o&&this.renderImage(),a=h.width/h.naturalWidth,i(e.x)&&(c.left=e.x*a+r.left),i(e.y)&&(c.top=e.y*a+r.top),i(e.width)&&(c.width=e.width*a),i(e.height)&&(c.height=e.height*a),this.setCropBoxData(c))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,s){e[s]=i[s]}),e},setCanvasData:function(e){var s=this.canvas,o=s.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(s.left=e.left),i(e.top)&&(s.top=e.top),i(e.width)?(s.width=e.width,s.height=e.width/o):i(e.height)&&(s.height=e.height,s.width=e.height*o),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var s,o,a=this.cropBox,n=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(a.left=e.left),i(e.top)&&(a.top=e.top),i(e.width)&&(s=!0,a.width=e.width),i(e.height)&&(o=!0,a.height=e.height),n&&(s?a.height=a.width/n:o&&(a.width=a.height*n)),this.renderCropBox())},getCroppedCanvas:function(i){var e,s,o,a,n,h,r,c,l,d,g;if(this.isBuilt&&ft)return this.isCropped?(t.isPlainObject(i)||(i={}),g=this.getData(),e=g.width,s=g.height,c=e/s,t.isPlainObject(i)&&(n=i.width,h=i.height,n?(h=n/c,r=n/e):h&&(n=h*c,r=h/s)),o=Dt(n||e),a=Dt(h||s),l=t("<canvas>")[0],l.width=o,l.height=a,d=l.getContext("2d"),i.fillColor&&(d.fillStyle=i.fillColor,d.fillRect(0,0,o,a)),d.drawImage.apply(d,function(){var t,i,o,a,n,h,c=p(this.$clone[0],this.image),l=c.width,d=c.height,u=this.canvas,f=[c],m=g.x+u.naturalWidth*(bt(g.scaleX||1)-1)/2,v=g.y+u.naturalHeight*(bt(g.scaleY||1)-1)/2;return m<=-e||m>l?m=t=o=n=0:m<=0?(o=-m,m=0,t=n=wt(l,e+m)):m<=l&&(o=0,t=n=wt(e,l-m)),t<=0||v<=-s||v>d?v=i=a=h=0:v<=0?(a=-v,v=0,i=h=wt(d,s+v)):v<=d&&(a=0,i=h=wt(s,d-v)),f.push(Dt(m),Dt(v),Dt(t),Dt(i)),r&&(o*=r,a*=r,n*=r,h*=r),n>0&&h>0&&f.push(Dt(o),Dt(a),Dt(n),Dt(h)),f}.call(this)),l):p(this.$clone[0],this.image)},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=xt(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,s=this.options;this.isLoaded&&!this.isDisabled&&(i=t===pt,e=s.movable&&t===dt,t=i||e?t:ut,this.$dragBox.data(it,t).toggleClass(T,i).toggleClass(Y,e),s.cropBoxMovable||this.$face.data(it,t).toggleClass(T,i).toggleClass(Y,e))}},v.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},v.setDefaults=function(i){t.extend(v.DEFAULTS,i)},v.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',v.other=t.fn.cropper,t.fn.cropper=function(i){var o,a=s(arguments,1);return this.each(function(){var e,s,n=t(this),h=n.data(k);if(!h){if(/destroy/.test(i))return;e=t.extend({},n.data(),t.isPlainObject(i)&&i),n.data(k,h=new v(this,e))}"string"==typeof i&&t.isFunction(s=h[i])&&(o=s.apply(h,a))}),e(o)?this:o},t.fn.cropper.Constructor=v,t.fn.cropper.setDefaults=v.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=v.other,this}}),function(t){"use strict";function i(t){this.el=t,this.image=this.el.find("img.image-editor__image"),this.form=this.el.find("form"),this.actionInput=this.form.find('input[name="action"]'),this._init()}i.prototype={_init:function(){this.cropButton=$("#toolCrop"),this.rotateCCWButton=$("#toolRotateCCW"),this.rotateCWButton=$("#toolRotateCW"),this.flipHorizontalButton=$("#toolFlipHorizontal"),this.flipVerticalButton=$("#toolFlipVertical"),this.grayscaleButton=$("#toolGrayscale"),this.sharpenButton=$("#toolSharpen"),this.blurButton=$("#toolBlur"),this._initEvents()},_initEvents:function(){var t=this;this.rotateCCWButton.bind("click",function(){t.actionInput.val("rotate_90"),t._submit()}),this.rotateCWButton.bind("click",function(){t.actionInput.val("rotate_270"),t._submit()}),this.flipHorizontalButton.bind("click",function(){t.actionInput.val("flip_h"),t._submit()}),this.flipVerticalButton.bind("click",function(){t.actionInput.val("flip_v"),t._submit()}),this.grayscaleButton.bind("click",function(){t.actionInput.val("greyscale"),t._submit()}),this.sharpenButton.bind("click",function(){t.actionInput.val("sharpen_10"),t._submit()}),this.blurButton.bind("click",function(){t.actionInput.val("blur_10"),t._submit()}),this._initCropper()},_submit:function(){this.form.submit()},_initCropper:function(){var t=this;this._cropEnabled=!1,this.image.cropper({movable:!1,zoomable:!1,rotatable:!1,scalable:!1,autoCrop:!1}),this.image.on("cropend.cropper",function(){t.cropButton.removeClass("button--disabled-plain"),t._cropEnabled=!0}),this.cropButton.on("click",function(i){i.preventDefault(),i.stopPropagation(),t._cropEnabled&&t._crop()})},_crop:function(){var t=this.image.cropper("getData");this.actionInput.val("crop_"+Math.floor(t.width)+","+Math.floor(t.height)+","+Math.max(Math.floor(t.x),0)+","+Math.max(Math.floor(t.y),0)),this._submit()}},t.ImageEditor=i}(window),$(function(){return new ImageEditor($("#imageEditor"))});