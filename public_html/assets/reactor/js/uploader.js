!function(t){"use strict";function i(t,i){this.zone=t,this._init(i)}function s(t,i){this.uploader=i,this._init(t)}i.prototype={_init:function(t){var i={selectButton:!1,uploadInput:!1,focusClass:"dropzone--enter",indicatorClass:"UploadIndicator",outputList:!1,outputAppend:!0,isDropzoneForm:!0};this.options=$.extend(i,t),this.uploadurl=this.options.isDropzoneForm?this.zone.attr("action"):this.zone.data("action"),this.maxsize=this.zone.data("maxsize"),this.fileQueue=[],this.statusUploadIndicators=[],this.currentFile=0,this.inProcess=!1,this.controller=null,this._initEvents()},_initEvents:function(){var i=this;this.zone.on("dragenter, dragover",function(t){t.preventDefault(),t.stopPropagation(),$(this).addClass("dropzone--focus")}),this.zone.on("dragleave",function(){$(this).removeClass("dropzone--focus")}),$(t).on("drop",function(t){t.preventDefault(),t.stopPropagation()}),this.zone.on("drop",function(t){t.preventDefault(),t.stopPropagation(),i._queueFiles(t.originalEvent.dataTransfer.files),$(this).removeClass("dropzone--focus")}),this.options.uploadInput&&$(this.options.uploadInput).on("change",function(){i._queueFiles($(this)[0].files)}),this.options.selectButton&&$(this.options.selectButton).on("click",function(t){t.preventDefault(),t.stopPropagation(),$(i.options.uploadInput).click()})},_queueFiles:function(t){for(var i=0;i<t.length;i++)if(t[i].size<this.maxsize){this._pushFile(t[i]);var s=this._createUploadIndicator(t[i]);if(this.options.outputList!==!1){var s=s.getHtml(),e=$(this.options.outputList);this.options.outputAppend?e.append(s):e.prepend(s)}}this.inProcess===!1&&this._upload()},_pushFile:function(t){var i=new FormData;i.append("file",t),this.fileQueue.push(i)},_createUploadIndicator:function(i){var s=t[this.options.indicatorClass],e=new s(i,this);return this.statusUploadIndicators.push(e),e},_upload:function(){this.currentFile<this.fileQueue.length?(this.inProcess=!0,this._uploadNextFile()):this.inProcess=!1},_uploadNextFile:function(){var t=this,i=this.fileQueue[this.currentFile],s=this.statusUploadIndicators[this.currentFile];$.ajax({xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){s.setProgress(ajax_loaded(t))}),t},url:t.uploadurl,type:"POST",contentType:!1,processData:!1,cache:!1,data:i,success:function(t){s.complete(t)}}).always(function(){t.currentFile++,t._upload()})}},t.Uploader=i,s.prototype={_init:function(t){this.container=$('<li class="document upload"></li>'),this.progress=$('<div class="upload__progress"></div>').appendTo(this.container),this.progressBar=$('<div class="upload__progress-bar"></div>').appendTo(this.progress),this.thumbnail=$('<div class="document-thumbnail"></div>').appendTo(this.container),this.filename=$('<p class="document__name upload__name">'+html_entities(t.name)+"</p>").appendTo(this.container)},getHtml:function(){return this.container},setProgress:function(t){var i=t.toString()+"%";this.progressBar.height(i).width(i),100===t&&this.progress.remove()},complete:function(t){this.setProgress(100),"success"===t.type?this._success(t.upload):"error"===t.type&&this._error(t.message)},_success:function(t){this.thumbnail.remove(),this.thumbnail=$(t.thumbnail).prependTo(this.container),this.link=$('<a class="upload__link" href="'+t.edit_url+'"> </a>').appendTo(this.container),this.filename.text(t.name)},_error:function(t){this.container.addClass("upload--danger"),this.thumbnail.remove(),$('<div class="upload__error"><div class="upload__error-message">'+t+"</div></div>").appendTo(this.container)}},t.UploadIndicator=s}(window);