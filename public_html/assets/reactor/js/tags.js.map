{"version":3,"sources":["tags.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tags.js","sourcesContent":[";(function (window) {\n    'use strict';\n\n    /**\n     * Tags constructor\n     */\n    function Tags(el) {\n        this.el = el;\n\n        this._init();\n    }\n\n    inheritsFrom(Tags, Searcher);\n\n    // Tags prototype\n    Tags.prototype._init = function () {\n        this.nodeid = this.el.data('nodeid');\n        this.storeurl = this.el.data('storeurl');\n        this.attachurl = this.el.data('attachurl');\n        this.detachurl = this.el.data('detachurl');\n        this.locale = this.el.data('locale');\n\n        this.tagsList = this.el.find('ul.tags-list');\n        this.tags = this.el.find('li.tag');\n\n        this.initSearcher();\n\n        this._initEvents();\n    }\n\n    Tags.prototype._extractItems = function () {\n        this.itemKeys = this.tags.map(function () {\n            return $(this).data('tagid');\n        }).get();\n    }\n\n    Tags.prototype._initEvents = function () {\n        var self = this;\n\n        this.tagsList.on('click', '.tag__option--detach', function () {\n            var tag = $(this).closest('li.tag');\n\n            if (!tag.hasClass('tag--disabled')) {\n                tag.addClass('tag--disabled');\n\n                self._detachTag(tag);\n            }\n        });\n    }\n\n    Tags.prototype._searchPressReturn = function (title) {\n        if (title == '') {\n            return;\n        }\n\n        var placeholder = $('<li class=\"tag tag--disabled tag--placeholder\"></li>').appendTo(this.tagsList),\n            self = this;\n\n        $.post(this.storeurl, {title: title}, function (response) {\n            if (response.type === 'success' && self.itemKeys.indexOf(parseInt(response.tag.id)) == -1) {\n                var tag = self._createTag(response.tag.id, response.tag.title, response.tag.translatable, response.tag.editurl, response.tag.translateurl);\n\n                placeholder.replaceWith(tag);\n\n                tag.removeClass('tag--disabled');\n\n                self._finishAddingTag(response.tag.id, tag);\n\n                return;\n            }\n\n            self._clearSearch();\n\n            placeholder.remove();\n\n            window.flash.addMessage(response.message, response.type);\n        });\n    }\n\n    Tags.prototype._search = function (keywords) {\n        var self = this;\n\n        if (!self.searching) {\n            $.post(this.searchurl, {q: keywords, locale: self.locale}, function (data) {\n                self._populateResults(data);\n            });\n        }\n    }\n\n    Tags.prototype._addResult = function (id, item) {\n        return $('<li class=\"related-search__result\" data-translatable=\"' + item.translatable + '\" data-editurl=\"' + item.editurl + '\"data-translateurl=\"' + item.translateurl + '\">' + item.title + '<input class=\"related-search__input\" type=\"text\" value=\"' + id + '\"></li>');\n    }\n\n    Tags.prototype._addItem = function (item) {\n        var id = parseInt(item.find('input').val());\n\n        var tag = this._createTag(id, item.text(), item.data('translatable'), item.data('editurl'), item.data('translateurl'));\n\n        this._attachTag(tag);\n\n        this._finishAddingTag(id, tag)\n    }\n\n    Tags.prototype._finishAddingTag = function (id, tag) {\n        this.tagsList.append(tag);\n\n        this.itemKeys.push(id);\n\n        this._clearSearch();\n\n        this.search.focus();\n    }\n\n    Tags.prototype._createTag = function (id, title, translatable, editurl, translateurl) {\n        var tag = $('<li class=\"tag tag--disabled\" data-tagid=\"' + id + '\"><span class=\"tag__option tag__option--detach\"><i class=\"tag__icon icon-cancel\"></i></span></li>');\n\n        $('<span class=\"tag__text\"><a href=\"' + editurl + '\" target=\"_blank\">' + title + '</a></span>').prependTo(tag);\n\n        if (translatable === true) {\n            $('<span class=\"tag__option\"><a href=\"' + translateurl + '\" target=\"_blank\"><i class=\"tag__icon icon-language\"></i></a></span>').appendTo(tag);\n        }\n\n        return tag;\n    }\n\n    Tags.prototype._attachTag = function (tag) {\n        $.post(this.attachurl, {tagid: tag.data('tagid')}, function (response) {\n            if (response.type === 'success') {\n                tag.removeClass('tag--disabled');\n            } else {\n                tag.remove();\n\n                window.flash.addMessage(response.message, response.type);\n            }\n        });\n    }\n\n    Tags.prototype._detachTag = function (tag) {\n        var id = tag.data('tagid'),\n            self = this;\n\n        $.post(this.detachurl, {tagid: id}, function (response) {\n            if (response.type === 'success') {\n                var i = self.itemKeys.indexOf(id);\n                delete self.itemKeys[i];\n\n                tag.remove();\n            } else {\n                tag.removeClass('tag--disabled');\n\n                window.flash.addMessage(response.message, response.type);\n            }\n        });\n    }\n\n    // Register tags to window namespace\n    window.Tags = Tags;\n\n})(window);\n\n$(function () {\n    return new Tags($('#nodesTags'));\n});"],"sourceRoot":"/source/"}