{"version":3,"sources":["tags.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"tags.js","sourcesContent":[";(function (window) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Tags constructor\r\n     */\r\n    function Tags(el) {\r\n        this.el = el;\r\n\r\n        this._init();\r\n    }\r\n\r\n    inheritsFrom(Tags, Searcher);\r\n\r\n    // Tags prototype\r\n    Tags.prototype._init = function () {\r\n        this.nodeid = this.el.data('nodeid');\r\n        this.storeurl = this.el.data('storeurl');\r\n        this.attachurl = this.el.data('attachurl');\r\n        this.detachurl = this.el.data('detachurl');\r\n        this.locale = this.el.data('locale');\r\n\r\n        this.tagsList = this.el.find('ul.tags-list');\r\n        this.tags = this.el.find('li.tag');\r\n\r\n        this.initSearcher();\r\n\r\n        this._initEvents();\r\n    }\r\n\r\n    Tags.prototype._extractItems = function () {\r\n        this.itemKeys = this.tags.map(function () {\r\n            return $(this).data('tagid');\r\n        }).get();\r\n    }\r\n\r\n    Tags.prototype._initEvents = function () {\r\n        var self = this;\r\n\r\n        this.tagsList.on('click', '.tag__option--detach', function () {\r\n            var tag = $(this).closest('li.tag');\r\n\r\n            if (!tag.hasClass('tag--disabled')) {\r\n                tag.addClass('tag--disabled');\r\n\r\n                self._detachTag(tag);\r\n            }\r\n        });\r\n    }\r\n\r\n    Tags.prototype._searchPressReturn = function (title) {\r\n        if (title == '') {\r\n            return;\r\n        }\r\n\r\n        var placeholder = $('<li class=\"tag tag--disabled tag--placeholder\"></li>').appendTo(this.tagsList),\r\n            self = this;\r\n\r\n        $.post(this.storeurl, {title: title}, function (response) {\r\n            if (response.type === 'success' && self.itemKeys.indexOf(parseInt(response.tag.id)) == -1) {\r\n                var tag = self._createTag(response.tag.id, response.tag.title, response.tag.translatable, response.tag.editurl, response.tag.translateurl);\r\n\r\n                placeholder.replaceWith(tag);\r\n\r\n                tag.removeClass('tag--disabled');\r\n\r\n                self._finishAddingTag(response.tag.id, tag);\r\n\r\n                return;\r\n            }\r\n\r\n            self._clearSearch();\r\n\r\n            placeholder.remove();\r\n\r\n            window.flash.addMessage(response.message, response.type);\r\n        });\r\n    }\r\n\r\n    Tags.prototype._search = function (keywords) {\r\n        var self = this;\r\n\r\n        if (!self.searching) {\r\n            $.post(this.searchurl, {q: keywords, locale: self.locale}, function (data) {\r\n                self._populateResults(data);\r\n            });\r\n        }\r\n    }\r\n\r\n    Tags.prototype._addResult = function (id, item) {\r\n        return $('<li class=\"related-search__result\" data-translatable=\"' + item.translatable + '\" data-editurl=\"' + item.editurl + '\"data-translateurl=\"' + item.translateurl + '\">' + item.title + '<input class=\"related-search__input\" type=\"text\" value=\"' + id + '\"></li>');\r\n    }\r\n\r\n    Tags.prototype._addItem = function (item) {\r\n        var id = parseInt(item.find('input').val());\r\n\r\n        var tag = this._createTag(id, item.text(), item.data('translatable'), item.data('editurl'), item.data('translateurl'));\r\n\r\n        this._attachTag(tag);\r\n\r\n        this._finishAddingTag(id, tag)\r\n    }\r\n\r\n    Tags.prototype._finishAddingTag = function (id, tag) {\r\n        this.tagsList.append(tag);\r\n\r\n        this.itemKeys.push(id);\r\n\r\n        this._clearSearch();\r\n\r\n        this.search.focus();\r\n    }\r\n\r\n    Tags.prototype._createTag = function (id, title, translatable, editurl, translateurl) {\r\n        var tag = $('<li class=\"tag tag--disabled\" data-tagid=\"' + id + '\"><span class=\"tag__option tag__option--detach\"><i class=\"tag__icon icon-cancel\"></i></span></li>');\r\n\r\n        $('<span class=\"tag__text\"><a href=\"' + editurl + '\" target=\"_blank\">' + title + '</a></span>').prependTo(tag);\r\n\r\n        if (translatable === true) {\r\n            $('<span class=\"tag__option\"><a href=\"' + translateurl + '\" target=\"_blank\"><i class=\"tag__icon icon-language\"></i></a></span>').appendTo(tag);\r\n        }\r\n\r\n        return tag;\r\n    }\r\n\r\n    Tags.prototype._attachTag = function (tag) {\r\n        $.post(this.attachurl, {tagid: tag.data('tagid')}, function (response) {\r\n            if (response.type === 'success') {\r\n                tag.removeClass('tag--disabled');\r\n            } else {\r\n                tag.remove();\r\n\r\n                window.flash.addMessage(response.message, response.type);\r\n            }\r\n        });\r\n    }\r\n\r\n    Tags.prototype._detachTag = function (tag) {\r\n        var id = tag.data('tagid'),\r\n            self = this;\r\n\r\n        $.post(this.detachurl, {tagid: id}, function (response) {\r\n            if (response.type === 'success') {\r\n                var i = self.itemKeys.indexOf(id);\r\n                delete self.itemKeys[i];\r\n\r\n                tag.remove();\r\n            } else {\r\n                tag.removeClass('tag--disabled');\r\n\r\n                window.flash.addMessage(response.message, response.type);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Register tags to window namespace\r\n    window.Tags = Tags;\r\n\r\n})(window);\r\n\r\n$(function () {\r\n    return new Tags($('#nodesTags'));\r\n});"],"sourceRoot":"/source/"}